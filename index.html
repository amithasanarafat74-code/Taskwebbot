<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskEarningsBD - টাস্ক করে আয় করুন</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0f; --bg-secondary: #12121a; --fg: #f0f0f5; --muted: #6b7280;
            --accent: #00d4aa; --accent-glow: rgba(0, 212, 170, 0.3);
            --card: rgba(18, 18, 26, 0.8); --border: rgba(255, 255, 255, 0.08);
            --danger: #ff4757; --warning: #ffa502; --success: #00d4aa;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans Bengali', sans-serif; background: var(--bg); color: var(--fg); min-height: 100vh; overflow-x: hidden; }
        .font-display { font-family: 'Space Grotesk', sans-serif; }
        .bg-mesh { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(ellipse 80% 50% at 20% -20%, rgba(0, 212, 170, 0.15) 0%, transparent 50%), radial-gradient(ellipse 60% 40% at 80% 100%, rgba(0, 150, 136, 0.1) 0%, transparent 50%), linear-gradient(180deg, var(--bg) 0%, var(--bg-secondary) 100%); }
        .grid-pattern { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background-image: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px); background-size: 60px 60px; mask-image: radial-gradient(ellipse at center, black 0%, transparent 70%); }
        .orb { position: fixed; border-radius: 50%; filter: blur(80px); opacity: 0.4; animation: float 20s ease-in-out infinite; pointer-events: none; }
        .orb-1 { width: 400px; height: 400px; background: var(--accent); top: -200px; right: -100px; animation-delay: 0s; }
        .orb-2 { width: 300px; height: 300px; background: #0891b2; bottom: -150px; left: -100px; animation-delay: -10s; }
        @keyframes float { 0%, 100% { transform: translate(0, 0) scale(1); } 25% { transform: translate(30px, -30px) scale(1.05); } 50% { transform: translate(-20px, 20px) scale(0.95); } 75% { transform: translate(20px, 10px) scale(1.02); } }
        .glass-card { background: var(--card); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 20px; transition: all 0.3s ease; }
        .glass-card:hover { border-color: rgba(0, 212, 170, 0.2); transform: translateY(-2px); }
        .btn-primary { background: linear-gradient(135deg, var(--accent) 0%, #00b894 100%); color: var(--bg); font-weight: 600; padding: 14px 28px; border-radius: 12px; border: none; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; }
        .btn-primary::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s ease; }
        .btn-primary:hover::before { left: 100%; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px var(--accent-glow); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .btn-secondary { background: rgba(255, 255, 255, 0.05); color: var(--fg); font-weight: 500; padding: 12px 24px; border-radius: 12px; border: 1px solid var(--border); cursor: pointer; transition: all 0.3s ease; }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.1); border-color: var(--accent); }
        .btn-danger { background: linear-gradient(135deg, var(--danger) 0%, #ee5a52 100%); color: white; font-weight: 600; padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; transition: all 0.3s ease; width: 100%; }
        .btn-success-sm { background: linear-gradient(135deg, var(--accent) 0%, #00b894 100%); color: var(--bg); font-weight: 600; padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; transition: all 0.3s ease; width: 100%; }
        .input-field { background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border); border-radius: 12px; padding: 14px 18px; color: var(--fg); font-size: 16px; width: 100%; transition: all 0.3s ease; font-family: inherit; }
        .input-field:focus { outline: none; border-color: var(--accent); background: rgba(0, 212, 170, 0.05); box-shadow: 0 0 0 4px var(--accent-glow); }
        .input-field::placeholder { color: var(--muted); }
        
        /* Navigation Style - Z-Index Increased for visibility */
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 12px 16px; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; color: var(--muted); }
        .nav-item.active { color: var(--accent); background: rgba(0, 212, 170, 0.1); }
        .nav-item:hover:not(.active) { color: var(--fg); background: rgba(255, 255, 255, 0.05); }
        
        .stat-card { position: relative; overflow: hidden; }
        .stat-card::before { content: ''; position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%); opacity: 0.5; }
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .stagger-item { opacity: 0; transform: translateY(30px); animation: staggerIn 0.6s ease forwards; }
        @keyframes staggerIn { to { opacity: 1; transform: translateY(0); } }
        .progress-bar { height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent), #00b894); border-radius: 4px; transition: width 1s ease; }
        .toast { position: fixed; top: 20px; right: 20px; padding: 16px 24px; border-radius: 12px; background: var(--card); border: 1px solid var(--border); backdrop-filter: blur(20px); transform: translateX(120%); transition: transform 0.4s ease; z-index: 20000; max-width: 90%; } /* Highest Z-Index for Toast */
        .toast.show { transform: translateX(0); }
        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--danger); }
        .toast.warning { border-color: var(--warning); }
        .task-card { position: relative; overflow: hidden; }
        .task-card::after { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--accent); opacity: 0; transition: opacity 0.3s ease; }
        .task-card:hover::after { opacity: 1; }
        .ripple { position: relative; overflow: hidden; }
        .ripple::after { content: ''; position: absolute; width: 100%; height: 100%; top: 0; left: 0; pointer-events: none; background-image: radial-gradient(circle, var(--accent-glow) 10%, transparent 10.01%); background-repeat: no-repeat; background-position: 50%; transform: scale(10, 10); opacity: 0; transition: transform 0.5s, opacity 1s; }
        .ripple:active::after { transform: scale(0, 0); opacity: 0.3; transition: 0s; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(15px); z-index: 1500; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-overlay.show { display: flex; }
        .modal-content { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 24px; padding: 24px; max-width: 450px; width: 100%; animation: modalIn 0.3s ease; max-height: 90vh; overflow-y: auto; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .status-pending { background: rgba(255, 165, 2, 0.2); color: var(--warning); }
        .status-approved { background: rgba(0, 212, 170, 0.2); color: var(--accent); }
        .status-rejected { background: rgba(255, 71, 87, 0.2); color: var(--danger); }
        .loading-spinner { width: 20px; height: 20px; border: 2px solid transparent; border-top-color: currentColor; border-radius: 50%; animation: spin 0.8s linear infinite; display: inline-block; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .admin-tab { padding: 10px 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s; border: 1px solid transparent; font-size: 13px; text-align: center; }
        .admin-tab.active { font-weight: 700; background: rgba(255, 255, 255, 0.1); }
        .admin-tab.pending-tab.active { border-color: var(--warning); color: var(--warning); }
        .admin-tab.approved-tab.active { border-color: var(--accent); color: var(--accent); }
        .admin-tab.rejected-tab.active { border-color: var(--danger); color: var(--danger); }
        .admin-tab:hover:not(.active) { background: rgba(255, 255, 255, 0.05); }
        
        /* Lock Screen Styles */
        .lock-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; text-align: center; padding: 20px; color: var(--fg); }
        .lock-icon { width: 80px; height: 80px; margin-bottom: 20px; color: var(--danger); }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }
        @media (prefers-reduced-motion: reduce) { *, *::before, *::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; } }
        @media (max-width: 640px) { .glass-card { border-radius: 16px; } }
    </style>
</head>
<body>
    <div class="bg-mesh"></div>
    <div class="grid-pattern"></div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>

    <!-- Device Lock Screen -->
    <div id="lockScreen" class="lock-screen hidden">
        <svg class="lock-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
        <h2 class="text-2xl font-bold mb-2">Device Limit Reached</h2>
        <p class="text-[var(--muted)] mb-4">এই ডিভাইসে ইতিমধ্যে একটি একাউন্ট রয়েছে। নতুন একাউন্ট খোলা সম্ভব নয়।</p>
        <p class="text-xs text-[var(--danger)]">One account per device policy.</p>
    </div>

    <div id="toast" class="toast"><p id="toastMessage"></p></div>

    <div id="loadingModal" class="modal-overlay">
        <div class="modal-content text-center" style="background: transparent; border: none; box-shadow: none;">
            <div class="loading-spinner mx-auto mb-4" style="width: 40px; height: 40px; border-width: 3px; border-top-color: var(--accent);"></div>
            <p id="loadingText">প্রসেসিং হচ্ছে...</p>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal-overlay">
        <div class="modal-content text-center">
            <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-[rgba(255,71,87,0.1)] flex items-center justify-center">
                <svg class="w-8 h-8 text-[var(--danger)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
            </div>
            <h3 class="text-xl font-bold mb-2">Admin Access</h3>
            <p class="text-sm text-[var(--muted)] mb-4">অ্যাডমিন প্যানেলে প্রবেশ করতে পাসওয়ার্ড দিন</p>
            <input type="password" id="adminPasswordInput" class="input-field mb-4 text-center" placeholder="••••••••">
            <div class="flex gap-3">
                <button onclick="closeAdminLogin()" class="btn-secondary flex-1">বাতিল</button>
                <button onclick="verifyAdminPassword()" class="btn-primary flex-1">লগইন</button>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard Modal -->
    <div id="adminDashboardModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-lg bg-[var(--danger)] flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
                    </div>
                    <h3 class="text-lg font-bold">Admin Control Panel</h3>
                </div>
                <button onclick="closeAdminDashboard()" class="text-[var(--muted)] hover:text-[var(--fg)]">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            
            <!-- Gmail Section -->
            <div class="mb-6">
                <h4 class="text-xs font-bold text-[var(--muted)] mb-2 uppercase tracking-wider flex items-center justify-between">
                    <span>Gmail Requests</span>
                    <span id="gmailPendingCount" class="text-[var(--warning)] font-normal normal-case">0 Pending</span>
                </h4>
                <div class="flex gap-1 mb-3 p-1 bg-[rgba(255,255,255,0.03)] rounded-xl">
                    <button onclick="switchAdminTab('gmail', 'pending')" id="tabGmailPending" class="admin-tab pending-tab flex-1">Pending</button>
                    <button onclick="switchAdminTab('gmail', 'approved')" id="tabGmailApproved" class="admin-tab approved-tab flex-1">Approved</button>
                    <button onclick="switchAdminTab('gmail', 'rejected')" id="tabGmailRejected" class="admin-tab rejected-tab flex-1">Rejected</button>
                </div>
                <div id="adminGmailList" class="space-y-3 max-h-[25vh] overflow-y-auto pr-2"></div>
            </div>

            <!-- Withdraw Section -->
            <div>
                <h4 class="text-xs font-bold text-[var(--muted)] mb-2 uppercase tracking-wider flex items-center justify-between">
                    <span>Withdraw Requests</span>
                    <span id="withdrawPendingCount" class="text-[var(--warning)] font-normal normal-case">0 Pending</span>
                </h4>
                <div class="flex gap-1 mb-3 p-1 bg-[rgba(255,255,255,0.03)] rounded-xl">
                    <button onclick="switchAdminTab('withdraw', 'pending')" id="tabWithdrawPending" class="admin-tab pending-tab flex-1">Pending</button>
                    <button onclick="switchAdminTab('withdraw', 'approved')" id="tabWithdrawApproved" class="admin-tab approved-tab flex-1">Approved</button>
                    <button onclick="switchAdminTab('withdraw', 'rejected')" id="tabWithdrawRejected" class="admin-tab rejected-tab flex-1">Rejected</button>
                </div>
                <div id="adminWithdrawList" class="space-y-3 max-h-[25vh] overflow-y-auto pr-2"></div>
            </div>
        </div>
    </div>

    <div class="max-w-md mx-auto min-h-screen pb-28"> <!-- Increased padding bottom slightly -->
        <!-- Header -->
        <header class="p-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-[var(--accent)] to-[#00b894] flex items-center justify-center">
                    <svg class="w-6 h-6 text-[var(--bg)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                </div>
                <div><h1 class="font-display font-bold text-lg">TaskEarningsBD</h1><p class="text-xs text-[var(--muted)]">টাস্ক করে আয় করুন</p></div>
            </div>
            <button onclick="showPage('profile')" class="w-10 h-10 rounded-xl bg-[var(--card)] border border-[var(--border)] flex items-center justify-center hover:border-[var(--accent)] transition-all">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
            </button>
        </header>

        <!-- Home Page -->
        <div id="homePage" class="page active px-4">
            <div class="glass-card stat-card p-6 mb-4 stagger-item" style="animation-delay: 0.1s">
                <div class="flex justify-between items-start mb-4">
                    <div><p class="text-sm text-[var(--muted)] mb-1">মোট ব্যালেন্স</p><h2 class="font-display text-4xl font-bold"><span id="balanceDisplay">0.00</span> টাকা</h2></div>
                    <div class="w-12 h-12 rounded-xl bg-[rgba(0,212,170,0.1)] flex items-center justify-center">
                        <svg class="w-6 h-6 text-[var(--accent)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-[rgba(255,255,255,0.03)] rounded-xl p-3"><p class="text-xs text-[var(--muted)]">আজকের আয়</p><p class="font-semibold text-lg"><span id="todayEarning">0.00</span> টাকা</p></div>
                    <div class="bg-[rgba(255,255,255,0.03)] rounded-xl p-3"><p class="text-xs text-[var(--muted)]">মোট উইথড্র</p><p class="font-semibold text-lg"><span id="totalWithdraw">0.00</span> টাকা</p></div>
                </div>
            </div>
            <div class="grid grid-cols-3 gap-3 mb-4">
                <button onclick="showPage('withdraw')" class="glass-card p-4 text-center stagger-item ripple" style="animation-delay: 0.2s"><div class="w-10 h-10 mx-auto mb-2 rounded-xl bg-[rgba(0,212,170,0.1)] flex items-center justify-center"><svg class="w-5 h-5 text-[var(--accent)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg></div><p class="text-sm font-medium">উইথড্র</p></button>
                <button onclick="showPage('refer')" class="glass-card p-4 text-center stagger-item ripple" style="animation-delay: 0.3s"><div class="w-10 h-10 mx-auto mb-2 rounded-xl bg-[rgba(255,165,2,0.1)] flex items-center justify-center"><svg class="w-5 h-5 text-[var(--warning)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg></div><p class="text-sm font-medium">রেফার</p></button>
                <button onclick="showPage('gmail')" class="glass-card p-4 text-center stagger-item ripple" style="animation-delay: 0.4s"><div class="w-10 h-10 mx-auto mb-2 rounded-xl bg-[rgba(255,71,87,0.1)] flex items-center justify-center"><svg class="w-5 h-5 text-[var(--danger)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg></div><p class="text-sm font-medium">জিমেইল সেল</p></button>
            </div>
            <div class="glass-card p-5 mb-4 stagger-item" style="animation-delay: 0.5s">
                <div class="flex justify-between items-center mb-4"><h3 class="font-semibold text-lg">দৈনিক টাস্ক</h3><span class="text-sm text-[var(--accent)]" id="taskProgress">0/5 সম্পন্ন</span></div>
                <div class="progress-bar mb-4"><div class="progress-fill" id="taskProgressBar" style="width: 0%"></div></div>
                <div class="space-y-3" id="tasksList"></div>
            </div>
            <div id="pendingApprovalsCard" class="glass-card p-5 mb-4 stagger-item hidden" style="animation-delay: 0.55s; border-color: rgba(255, 165, 2, 0.3);">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-xl bg-[rgba(255,165,2,0.1)] flex items-center justify-center"><svg class="w-5 h-5 text-[var(--warning)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></div>
                    <div><p class="font-semibold">অপেক্ষমান রিকোয়েস্ট</p><p class="text-xs text-[var(--muted)]">অ্যাডমিন অনুমোদনের অপেক্ষায়</p></div>
                </div>
                <div id="pendingApprovalsList" class="space-y-2"></div>
            </div>
            <div class="glass-card p-5 stagger-item" style="animation-delay: 0.6s"><h3 class="font-semibold text-lg mb-4">সাম্প্রতিক কার্যকলাপ</h3><div class="space-y-3" id="activityList"></div></div>
        </div>

        <!-- Withdraw Page -->
        <div id="withdrawPage" class="page px-4">
            <div class="flex items-center gap-3 mb-6"><button onclick="showPage('home')" class="w-10 h-10 rounded-xl bg-[var(--card)] border border-[var(--border)] flex items-center justify-center hover:border-[var(--accent)] transition-all"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg></button><h2 class="font-display font-bold text-xl">উইথড্র করুন</h2></div>
            <div id="walletSetup" class="glass-card p-5 mb-4"><h3 class="font-semibold mb-4">পেমেন্ট ওয়ালেট সেটআপ</h3><div class="space-y-4"><div><label class="block text-sm text-[var(--muted)] mb-2">পেমেন্ট মেথড</label><select id="paymentMethod" class="input-field" onchange="updateWalletPlaceholder()"><option value="bkash">বিকাশ</option><option value="nagad">নগদ</option><option value="rocket">রকেট</option></select></div><div><label class="block text-sm text-[var(--muted)] mb-2">ওয়ালেট নম্বর</label><input type="text" id="walletNumber" class="input-field" placeholder="01XXXXXXXXX" maxlength="11"></div><button onclick="saveWallet()" class="btn-primary w-full ripple">ওয়ালেট সেভ করুন</button></div></div>
            <div id="withdrawForm" class="glass-card p-5 mb-4 hidden">
                <div class="flex justify-between items-center mb-4"><div><p class="text-sm text-[var(--muted)]">উপলব্ধ ব্যালেন্স</p><p class="font-display text-2xl font-bold"><span id="withdrawableBalance">0.00</span> টাকা</p></div><div class="text-right"><p class="text-sm text-[var(--muted)]">পেমেন্ট মেথড</p><p class="font-semibold text-[var(--accent)]" id="savedPaymentMethod">বিকাশ</p></div></div>
                <div class="bg-[rgba(0,212,170,0.05)] border border-[rgba(0,212,170,0.2)] rounded-xl p-4 mb-4"><p class="text-sm"><span class="text-[var(--accent)]">ন্যূনতম:</span> 10 টাকা</p><p class="text-sm"><span class="text-[var(--accent)]">সর্বোচ্চ:</span> <span id="maxWithdraw">0</span> টাকা</p></div>
                <div class="mb-4"><label class="block text-sm text-[var(--muted)] mb-2">উইথড্র পরিমাণ</label><input type="number" id="withdrawAmount" class="input-field" placeholder="পরিমাণ লিখুন" min="10"></div>
                <button id="withdrawBtn" onclick="requestWithdraw()" class="btn-primary w-full ripple">উইথড্র রিকোয়েস্ট পাঠান</button>
            </div>
            <div class="glass-card p-5"><h3 class="font-semibold mb-4">উইথড্র ইতিহাস</h3><div class="space-y-3" id="withdrawHistory"><p class="text-center text-[var(--muted)] py-4">কোনো উইথড্র নেই</p></div></div>
        </div>

        <!-- Refer Page -->
        <div id="referPage" class="page px-4">
            <div class="flex items-center gap-3 mb-6"><button onclick="showPage('home')" class="w-10 h-10 rounded-xl bg-[var(--card)] border border-[var(--border)] flex items-center justify-center hover:border-[var(--accent)] transition-all"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg></button><h2 class="font-display font-bold text-xl">রেফারেল প্রোগ্রাম</h2></div>
            <div class="glass-card p-5 mb-4"><div class="grid grid-cols-2 gap-4"><div class="text-center"><p class="text-3xl font-bold text-[var(--accent)]" id="totalRefers">0</p><p class="text-sm text-[var(--muted)]">মোট রেফার</p></div><div class="text-center"><p class="text-3xl font-bold text-[var(--warning)]" id="referEarnings">0.00</p><p class="text-sm text-[var(--muted)]">রেফার আয় (টাকা)</p></div></div></div>
            <div class="glass-card p-5 mb-4">
                <div class="flex items-center gap-2 mb-3"><svg class="w-5 h-5 text-[var(--accent)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg><h3 class="font-semibold">রেফারেল লিংক</h3></div>
                <div class="bg-[rgba(0,212,170,0.05)] border border-[rgba(0,212,170,0.2)] rounded-xl p-3 mb-3">
                    <p class="text-xs break-all text-[var(--accent)]" id="referralLink">Loading...</p>
                </div>
                <!-- Copy Button Fixed -->
                <button onclick="copyReferralLink()" class="btn-secondary w-full flex items-center justify-center gap-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/></svg> লিংক কপি করুন</button>
            </div>
            <div class="grid grid-cols-2 gap-3">
                <button onclick="shareOnTelegram()" class="btn-secondary flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/></svg> টেলিগ্রাম
                </button>
                <button onclick="shareOnWhatsApp()" class="btn-secondary flex items-center justify-center gap-2"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg> হোয়াটসঅ্যাপ</button>
            </div>
            <p class="text-xs text-center text-[var(--muted)] mt-4">লিংকটি ক্লিক করলে সরাসরি টেলিগ্রাম বট ওপেন হবে।</p>
        </div>

        <!-- Gmail Sell Page -->
        <div id="gmailPage" class="page px-4">
            <div class="flex items-center gap-3 mb-6"><button onclick="showPage('home')" class="w-10 h-10 rounded-xl bg-[var(--card)] border border-[var(--border)] flex items-center justify-center hover:border-[var(--accent)] transition-all"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg></button><h2 class="font-display font-bold text-xl">জিমেইল বিক্রি করুন</h2></div>
            <div class="glass-card p-5 mb-4" style="background: linear-gradient(135deg, rgba(255,71,87,0.1) 0%, rgba(255,165,2,0.1) 100%);"><div class="flex items-center gap-3 mb-3"><div class="w-12 h-12 rounded-xl bg-[rgba(255,71,87,0.2)] flex items-center justify-center"><svg class="w-6 h-6 text-[var(--danger)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg></div><div><p class="text-sm text-[var(--muted)]">প্রতিটি জিমেইল</p><p class="text-2xl font-bold text-[var(--warning)]">5 টাকা</p></div></div><p class="text-sm text-[var(--muted)]">আপনার অব্যবহৃত জিমেইল একাউন্ট বিক্রি করে আয় করুন!</p></div>
            <div class="glass-card p-5 mb-4">
                <h3 class="font-semibold mb-4">জিমেইল জমা দিন</h3>
                <div class="space-y-4">
                    <div><label class="block text-sm text-[var(--muted)] mb-2">জিমেইল ঠিকানা</label><input type="email" id="gmailAddress" class="input-field" placeholder="example@gmail.com"></div>
                    <div><label class="block text-sm text-[var(--muted)] mb-2">পাসওয়ার্ড</label><div class="relative"><input type="password" id="gmailPassword" class="input-field pr-12" placeholder="••••••••"><button type="button" onclick="togglePasswordVisibility()" class="absolute right-3 top-1/2 -translate-y-1/2 text-[var(--muted)] hover:text-[var(--fg)] transition-colors"><svg id="eyeIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg></button></div></div>
                    <div class="bg-[rgba(255,165,2,0.1)] border border-[rgba(255,165,2,0.2)] rounded-xl p-3"><p class="text-sm text-[var(--warning)]">নোট: শুধুমাত্র সত্যিকারের জিমেইল জমা দিন। অ্যাডমিন যাচাই করে অনুমোদন করবে।</p></div>
                    <button id="gmailSubmitBtn" onclick="submitGmail()" class="btn-primary w-full ripple">জিমেইল জমা দিন</button>
                </div>
            </div>
            <div class="glass-card p-5"><h3 class="font-semibold mb-4">জমা দেওয়া জিমেইল</h3><div class="space-y-3" id="gmailHistory"><p class="text-center text-[var(--muted)] py-4">কোনো জিমেইল জমা দেওয়া হয়নি</p></div></div>
        </div>

        <!-- Profile Page -->
        <div id="profilePage" class="page px-4">
            <div class="flex items-center gap-3 mb-6"><button onclick="showPage('home')" class="w-10 h-10 rounded-xl bg-[var(--card)] border border-[var(--border)] flex items-center justify-center hover:border-[var(--accent)] transition-all"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg></button><h2 class="font-display font-bold text-xl">প্রোফাইল</h2></div>
            <div class="glass-card p-5 mb-4 text-center"><div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-[var(--accent)] to-[#00b894] flex items-center justify-center"><span class="text-3xl font-bold text-[var(--bg)]" id="profileInitial">U</span></div><h3 class="font-semibold text-xl mb-1" id="profileName">ব্যবহারকারী</h3><p class="text-sm text-[var(--muted)]" id="profileId">ID: USER001</p></div>
            <div class="grid grid-cols-2 gap-3 mb-4"><div class="glass-card p-4 text-center"><p class="text-2xl font-bold text-[var(--accent)]" id="profileBalance">0.00</p><p class="text-xs text-[var(--muted)]">ব্যালেন্স (টাকা)</p></div><div class="glass-card p-4 text-center"><p class="text-2xl font-bold text-[var(--warning)]" id="profileTasks">0</p><p class="text-xs text-[var(--muted)]">টাস্ক সম্পন্ন</p></div></div>
            <div class="glass-card p-5 mb-4">
                <h3 class="font-semibold mb-4">সেটিংস</h3>
                <div class="space-y-2">
                    <button onclick="checkForUpdates()" class="w-full flex items-center justify-between p-3 rounded-xl hover:bg-[rgba(255,255,255,0.05)] transition-colors border border-transparent hover:border-[var(--accent)]"><div class="flex items-center gap-3"><svg class="w-5 h-5 text-[var(--accent)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg><span>স্ট্যাটাস চেক করুন</span></div><svg class="w-5 h-5 text-[var(--muted)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></button>
                    <button onclick="openAdminLogin()" class="w-full flex items-center justify-between p-3 rounded-xl hover:bg-[rgba(255,71,87,0.1)] transition-colors border border-transparent hover:border-[var(--danger)]"><div class="flex items-center gap-3"><svg class="w-5 h-5 text-[var(--danger)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg><span class="text-[var(--danger)] font-medium">Admin Panel</span></div><svg class="w-5 h-5 text-[var(--danger)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></button>
                </div>
            </div>
            <p class="text-xs text-center text-[var(--muted)] mt-4 opacity-50">Device ID: <span id="displayDeviceId">Loading...</span></p>
        </div>
    </div>

    <!-- Bottom Navigation - Z-INDEX FIXED -->
    <nav class="fixed bottom-0 left-0 right-0 bg-[var(--card)] backdrop-blur-xl border-t border-[var(--border)] z-[10000]">
        <!-- Added pb-safe for iOS safe area -->
        <div class="max-w-md mx-auto flex justify-around py-2 pb-[calc(0.5rem+env(safe-area-inset-bottom))]">
            <button onclick="showPage('home')" class="nav-item active" id="navHome"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg><span class="text-xs">হোম</span></button>
            <button onclick="showPage('withdraw')" class="nav-item" id="navWithdraw"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg><span class="text-xs">উইথড্র</span></button>
            <button onclick="showPage('refer')" class="nav-item" id="navRefer"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg><span class="text-xs">রেফার</span></button>
            <button onclick="showPage('gmail')" class="nav-item" id="navGmail"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg><span class="text-xs">জিমেইল</span></button>
        </div>
    </nav>

    <script>
        // ==================== CONFIGURATION ====================
        const TELEGRAM_BOT_TOKEN = '8324136233:AAHIWXiyB1IQmr68xFRHfqv58H12LALhnsQ';
        const BOT_USERNAME = 'TaskEarningBD1_bot'; 
        const WITHDRAW_GROUP_ID = '-1003766223753'; 
        const GMAIL_GROUP_ID = '-1003773920589';   
        const ADMIN_PASSWORD = 'adminamit123'; 
        const MIN_WITHDRAW = 10;
        const PER_REFER = 1;
        const PER_GMAIL = 5;
        const TOTAL_TASKS = 5;

        // ==================== DEVICE FINGERPRINT ====================
        function generateDeviceId() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = "top";
            ctx.font = "14px 'Arial'";
            ctx.textBaseline = "alphabetic";
            ctx.fillStyle = "#f60";
            ctx.fillRect(125,1,62,20);
            ctx.fillStyle = "#069";
            ctx.fillText("TaskBD", 2, 15);
            const dataUrl = canvas.toDataURL();
            
            let hash = 0;
            const str = dataUrl + navigator.userAgent + screen.width + screen.height + navigator.language + new Date().getTimezoneOffset();
            for(let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash<<5)-hash)+char;
                hash = hash & hash;
            }
            return 'DEV-' + Math.abs(hash).toString(16).toUpperCase();
        }

        const CURRENT_DEVICE_ID = generateDeviceId();
        const DEVICE_LOCK_KEY = 'taskBD_device_locked';

        // ==================== DATA STRUCTURES ====================
        function generateReferralCode() { const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'; let code = 'TE-'; for (let i = 0; i < 6; i++) { code += chars.charAt(Math.floor(Math.random() * chars.length)); } return code; }
        
        let userData = null;
        let tasks = [ { id: 1, title: 'প্রতিদিন লগইন করুন', reward: 0.50, completed: false }, { id: 2, title: 'টেলিগ্রাম চ্যানেল জয়েন করুন', reward: 1.00, completed: false, link: 'https://t.me/taskearningsbd' }, { id: 3, title: 'ইউটিউব ভিডিও দেখুন', reward: 0.75, completed: false, link: 'https://t.me/freeearningzonebd1_2' }, { id: 4, title: 'বন্ধুকে রেফার করুন', reward: 1.00, completed: false }, { id: 5, title: 'ফেসবুক পেজ লাইক করুন', reward: 0.50, completed: false, link: 'https://facebook.com' } ];
        let activities = [];
        let gmailSubmissions = [];
        let withdrawRequests = [];

        // ==================== TELEGRAM API ====================
        async function sendTelegramMessage(message, groupId) { try { const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ chat_id: groupId, text: message, parse_mode: 'HTML' }) }); const data = await response.json(); return data.ok; } catch (error) { console.error('Telegram API Error:', error); return false; } }

        // ==================== DEVICE LOCK CHECK ====================
        function checkDeviceLock() {
            const savedLock = localStorage.getItem(DEVICE_LOCK_KEY);
            const savedUser = localStorage.getItem('taskBD_user');

            const displayId = document.getElementById('displayDeviceId');
            if(displayId) displayId.textContent = CURRENT_DEVICE_ID;

            if (savedLock) {
                if (savedUser) {
                    const user = JSON.parse(savedUser);
                    if (user.deviceId === CURRENT_DEVICE_ID) return true;
                    else if (user.deviceId && user.deviceId !== CURRENT_DEVICE_ID) { showLockScreen(); return false; }
                } else { showLockScreen(); return false; }
            }
            return true;
        }

        function showLockScreen() { const lockScreen = document.getElementById('lockScreen'); if(lockScreen) lockScreen.classList.remove('hidden'); }
        function lockDevice(userId) { localStorage.setItem(DEVICE_LOCK_KEY, userId); }

        // ==================== INITIALIZATION ====================
        function initApp() {
            if (!checkDeviceLock()) return;

            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('startapp') || urlParams.get('ref');
            
            loadAllData();
            
            if (!userData) {
                userData = {
                    id: 'USER' + Math.random().toString(36).substr(2, 6).toUpperCase(), name: 'ব্যবহারকারী', balance: 0, todayEarning: 0, totalWithdraw: 0, totalRefers: 0, tasksCompleted: 0, wallet: null, paymentMethod: 'bkash', referralCode: generateReferralCode(), referredBy: null, allTasksCompleted: false, deviceId: CURRENT_DEVICE_ID
                };
                if (refCode) userData.referredBy = refCode;
                saveUserData();
                lockDevice(userData.id);
            } else {
                if(!localStorage.getItem(DEVICE_LOCK_KEY)) lockDevice(userData.id);
                if (refCode && !userData.referredBy) { userData.referredBy = refCode; saveUserData(); }
            }
            
            updateUI(); renderTasks(); renderActivity(); renderWithdrawHistory(); renderGmailHistory(); renderPendingRefers(); updatePendingApprovalsCard();
        }

        function loadAllData() {
            const savedUser = localStorage.getItem('taskBD_user'); if (savedUser) userData = JSON.parse(savedUser);
            const savedTasks = localStorage.getItem('taskBD_tasks'); if (savedTasks) { const tasksState = JSON.parse(savedTasks); tasks.forEach(task => { if (tasksState[task.id] !== undefined) task.completed = tasksState[task.id]; }); }
            const savedGmail = localStorage.getItem('taskBD_gmail'); if (savedGmail) gmailSubmissions = JSON.parse(savedGmail);
            const savedWithdraw = localStorage.getItem('taskBD_withdraw'); if (savedWithdraw) withdrawRequests = JSON.parse(savedWithdraw);
            const savedActivities = localStorage.getItem('taskBD_activities'); if (savedActivities) activities = JSON.parse(savedActivities);
        }

        function saveUserData() { if(userData) { userData.deviceId = CURRENT_DEVICE_ID; localStorage.setItem('taskBD_user', JSON.stringify(userData)); } }
        function saveTasksState() { const state = {}; tasks.forEach(t => state[t.id] = t.completed); localStorage.setItem('taskBD_tasks', JSON.stringify(state)); }
        function saveGmailSubmissions() { localStorage.setItem('taskBD_gmail', JSON.stringify(gmailSubmissions)); }
        function saveWithdrawRequests() { localStorage.setItem('taskBD_withdraw', JSON.stringify(withdrawRequests)); }
        function saveActivities() { localStorage.setItem('taskBD_activities', JSON.stringify(activities)); }

        // ==================== UI UPDATES ====================
        function updateUI() { if(!userData) return; const elements = { balanceDisplay: userData.balance.toFixed(2), todayEarning: userData.todayEarning.toFixed(2), totalWithdraw: userData.totalWithdraw.toFixed(2), withdrawableBalance: userData.balance.toFixed(2), maxWithdraw: Math.floor(userData.balance), profileBalance: userData.balance.toFixed(2), profileTasks: userData.tasksCompleted, profileId: 'ID: ' + userData.id, totalRefers: userData.totalRefers, referEarnings: (userData.totalRefers * PER_REFER).toFixed(2), referralLink: `https://t.me/${BOT_USERNAME}?startapp=${userData.referralCode}` }; Object.keys(elements).forEach(id => { const el = document.getElementById(id); if (el) el.textContent = elements[id]; }); const walletSetup = document.getElementById('walletSetup'); const withdrawForm = document.getElementById('withdrawForm'); const savedMethod = document.getElementById('savedPaymentMethod'); if (userData.wallet) { if (walletSetup) walletSetup.classList.add('hidden'); if (withdrawForm) withdrawForm.classList.remove('hidden'); if (savedMethod) savedMethod.textContent = getPaymentMethodName(userData.paymentMethod); } else { if (walletSetup) walletSetup.classList.remove('hidden'); if (withdrawForm) withdrawForm.classList.add('hidden'); } }
        function getPaymentMethodName(method) { const names = { bkash: 'বিকাশ', nagad: 'নগদ', rocket: 'রকেট' }; return names[method] || method; }
        function formatDate(date) { return date.toLocaleString('bn-BD', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' }); }
        function getStatusText(status) { const texts = { pending: 'অপেক্ষমান', approved: 'অনুমোদিত', rejected: 'প্রত্যাখ্যাত' }; return texts[status] || status; }

        // ==================== PAGE NAVIGATION ====================
        function showPage(page) { const pages = ['home', 'withdraw', 'refer', 'gmail', 'profile']; pages.forEach(p => { const el = document.getElementById(p + 'Page'); if (el) el.classList.remove('active'); }); const target = document.getElementById(page + 'Page'); if (target) target.classList.add('active'); document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active')); const navItem = document.getElementById('nav' + page.charAt(0).toUpperCase() + page.slice(1)); if (navItem) navItem.classList.add('active'); }

        // ==================== TOAST & LOADING ====================
        function showToast(message, type = 'success') { const toast = document.getElementById('toast'); const toastMessage = document.getElementById('toastMessage'); if (!toast || !toastMessage) return; toast.classList.remove('success', 'error', 'warning'); toast.classList.add(type); toastMessage.textContent = message; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 3500); }
        function showLoading(text = 'প্রসেসিং হচ্ছে...') { const modal = document.getElementById('loadingModal'); const loadingText = document.getElementById('loadingText'); if (modal) { if (loadingText) loadingText.textContent = text; modal.classList.add('show'); } }
        function hideLoading() { const modal = document.getElementById('loadingModal'); if (modal) modal.classList.remove('show'); }

        // ==================== WALLET MANAGEMENT ====================
        function saveWallet() { const methodEl = document.getElementById('paymentMethod'); const numberEl = document.getElementById('walletNumber'); if (!methodEl || !numberEl) return; const method = methodEl.value; const number = numberEl.value.trim(); if (!number || number.length < 11) { showToast('সঠিক ওয়ালেট নম্বর দিন (১১ ডিজিট)', 'error'); return; } const phoneRegex = /^01[3-9]\d{8}$/; if (!phoneRegex.test(number)) { showToast('সঠিক বাংলাদেশি নম্বর দিন', 'error'); return; } userData.paymentMethod = method; userData.wallet = number; saveUserData(); updateUI(); showToast('ওয়ালেট সফলভাবে সেভ হয়েছে!'); }
        function updateWalletPlaceholder() { const numberEl = document.getElementById('walletNumber'); if (numberEl) numberEl.placeholder = '01XXXXXXXXX'; }

        // ==================== WITHDRAW SYSTEM ====================
        async function requestWithdraw() { const amountEl = document.getElementById('withdrawAmount'); if (!amountEl) return; const amount = parseFloat(amountEl.value); if (!amount || isNaN(amount)) { showToast('সঠিক পরিমাণ লিখুন', 'error'); return; } if (amount < MIN_WITHDRAW) { showToast(`ন্যূনতম ${MIN_WITHDRAW} টাকা উইথড্র করতে পারবেন`, 'error'); return; } if (amount > userData.balance) { showToast('অপর্যাপ্ত ব্যালেন্স', 'error'); return; } if (!userData.wallet) { showToast('প্রথমে ওয়ালেট সেটআপ করুন', 'error'); return; } const btn = document.getElementById('withdrawBtn'); if (btn) btn.disabled = true; showLoading('উইথড্র রিকোয়েস্ট পাঠানো হচ্ছে...'); const requestId = 'WD' + Date.now().toString(36).toUpperCase(); const request = { id: requestId, userId: userData.id, amount: amount, method: getPaymentMethodName(userData.paymentMethod), wallet: userData.wallet, status: 'pending', createdAt: new Date().toISOString(), createdAtFormatted: formatDate(new Date()) }; const telegramMessage = `<b>Withdrawal Request</b>\n\n<b>Request ID:</b> ${requestId}\n<b>User ID:</b> ${userData.id}\n<b>Device ID:</b> ${CURRENT_DEVICE_ID}\n<b>Amount:</b> ${amount} টাকা\n<b>Method:</b> ${request.method}\n<b>Wallet:</b> ${userData.wallet}\n<b>Time:</b> ${request.createdAtFormatted}\n\n<i>Status: Pending Approval</i>\n\n#withdraw #${userData.id}`; const sent = await sendTelegramMessage(telegramMessage, WITHDRAW_GROUP_ID); if (sent) { userData.balance -= amount; withdrawRequests.unshift(request); addActivity('withdraw', `${amount} টাকা উইথড্র রিকোয়েস্ট`, 0); saveUserData(); saveWithdrawRequests(); saveActivities(); updateUI(); renderWithdrawHistory(); updatePendingApprovalsCard(); amountEl.value = ''; showToast('উইথড্র রিকোয়েস্ট পাঠানো হয়েছে!'); } else { showToast('রিকোয়েস্ট পাঠাতে সমস্যা হয়েছে। আবার চেষ্টা করুন।', 'error'); } if (btn) btn.disabled = false; hideLoading(); }
        function renderWithdrawHistory() { const container = document.getElementById('withdrawHistory'); if (!container) return; if (withdrawRequests.length === 0) { container.innerHTML = '<p class="text-center text-[var(--muted)] py-4">কোনো উইথড্র নেই</p>'; return; } container.innerHTML = withdrawRequests.map(w => `<div class="bg-[rgba(255,255,255,0.03)] rounded-xl p-4"><div class="flex justify-between items-start mb-2"><div><p class="font-semibold text-lg">${w.amount} টাকা</p><p class="text-xs text-[var(--muted)]">${w.method} - ${w.wallet}</p></div><span class="px-3 py-1 rounded-full text-xs status-${w.status}">${getStatusText(w.status)}</span></div><p class="text-xs text-[var(--muted)]">${w.createdAtFormatted}</p></div>`).join(''); }

        // ==================== GMAIL SELL SYSTEM ====================
        async function submitGmail() { const addressEl = document.getElementById('gmailAddress'); const passwordEl = document.getElementById('gmailPassword'); if (!addressEl || !passwordEl) return; const address = addressEl.value.trim(); const password = passwordEl.value; if (!address || !address.includes('@')) { showToast('সঠিক জিমেইল ঠিকানা দিন', 'error'); return; } if (!password || password.length < 6) { showToast('পাসওয়ার্ড কমপক্ষে ৬ অক্ষর হতে হবে', 'error'); return; } const btn = document.getElementById('gmailSubmitBtn'); if (btn) btn.disabled = true; showLoading('জিমেইল জমা দেওয়া হচ্ছে...'); const requestId = 'GM' + Date.now().toString(36).toUpperCase(); const request = { id: requestId, userId: userData.id, email: address, password: password, status: 'pending', createdAt: new Date().toISOString(), createdAtFormatted: formatDate(new Date()) }; const telegramMessage = `<b>Gmail Sell Request</b>\n\n<b>Request ID:</b> ${requestId}\n<b>User ID:</b> ${userData.id}\n<b>Device ID:</b> ${CURRENT_DEVICE_ID}\n<b>Email:</b> ${address}\n<b>Password:</b> <code>${password}</code>\n<b>Time:</b> ${request.createdAtFormatted}\n\n<i>Status: Pending Verification</i>\n\n#gmail #${userData.id}`; const sent = await sendTelegramMessage(telegramMessage, GMAIL_GROUP_ID); if (sent) { gmailSubmissions.unshift(request); addActivity('gmail', `জিমেইল জমা: ${address}`, 0); saveGmailSubmissions(); saveActivities(); renderGmailHistory(); updatePendingApprovalsCard(); addressEl.value = ''; passwordEl.value = ''; showToast('জিমেইল জমা হয়েছে! অ্যাডমিন অনুমোদনের অপেক্ষায়।'); } else { showToast('জমা দিতে সমস্যা হয়েছে। আবার চেষ্টা করুন।', 'error'); } if (btn) btn.disabled = false; hideLoading(); }
        function renderGmailHistory() { const container = document.getElementById('gmailHistory'); if (!container) return; if (gmailSubmissions.length === 0) { container.innerHTML = '<p class="text-center text-[var(--muted)] py-4">কোনো জিমেইল জমা দেওয়া হয়নি</p>'; return; } container.innerHTML = gmailSubmissions.map(g => `<div class="bg-[rgba(255,255,255,0.03)] rounded-xl p-4"><div class="flex justify-between items-start mb-2"><div><p class="font-semibold">${g.email}</p><p class="text-xs text-[var(--muted)]">${g.createdAtFormatted}</p></div><span class="px-3 py-1 rounded-full text-xs status-${g.status}">${g.status === 'approved' ? '+' + PER_GMAIL + ' টাকা' : getStatusText(g.status)}</span></div></div>`).join(''); }
        function togglePasswordVisibility() { const input = document.getElementById('gmailPassword'); const icon = document.getElementById('eyeIcon'); if (!input || !icon) return; if (input.type === 'password') { input.type = 'text'; icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>'; } else { input.type = 'password'; icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>'; } }

        // ==================== ADMIN PANEL LOGIC ====================
        let adminCurrentTab = { type: 'gmail', status: 'pending' };

        function openAdminLogin() { const modal = document.getElementById('adminLoginModal'); const input = document.getElementById('adminPasswordInput'); if (modal) modal.classList.add('show'); if (input) input.value = ''; }
        function closeAdminLogin() { const modal = document.getElementById('adminLoginModal'); if (modal) modal.classList.remove('show'); }
        function verifyAdminPassword() { const input = document.getElementById('adminPasswordInput'); if (!input) return; if (input.value === ADMIN_PASSWORD) { closeAdminLogin(); openAdminDashboard(); } else { showToast('ভুল পাসওয়ার্ড!', 'error'); } }
        function openAdminDashboard() { const modal = document.getElementById('adminDashboardModal'); if (modal) modal.classList.add('show'); switchAdminTab('gmail', 'pending'); }
        function closeAdminDashboard() { const modal = document.getElementById('adminDashboardModal'); if (modal) modal.classList.remove('show'); }
        
        function switchAdminTab(type, status) {
            adminCurrentTab = { type, status };
            ['gmail', 'withdraw'].forEach(t => ['pending', 'approved', 'rejected'].forEach(s => { const tab = document.getElementById(`tab${t.charAt(0).toUpperCase() + t.slice(1)}${s.charAt(0).toUpperCase() + s.slice(1)}`); if(tab) tab.classList.remove('active'); }));
            const activeTab = document.getElementById(`tab${type.charAt(0).toUpperCase() + type.slice(1)}${status.charAt(0).toUpperCase() + status.slice(1)}`);
            if(activeTab) activeTab.classList.add('active');
            
            if (type === 'gmail') { document.getElementById('adminGmailList').classList.remove('hidden'); document.getElementById('adminWithdrawList').classList.add('hidden'); renderAdminList('gmail', status); } else { document.getElementById('adminGmailList').classList.add('hidden'); document.getElementById('adminWithdrawList').classList.remove('hidden'); renderAdminList('withdraw', status); }
        }

        function renderAdminList(type, status) {
            const listId = type === 'gmail' ? 'adminGmailList' : 'adminWithdrawList';
            const listEl = document.getElementById(listId);
            if(!listEl) return;

            let data = type === 'gmail' ? gmailSubmissions : withdrawRequests;
            let filtered = data.filter(d => d.status === status);
            
            if (status === 'pending') { const badgeId = type === 'gmail' ? 'gmailPendingCount' : 'withdrawPendingCount'; const badge = document.getElementById(badgeId); if(badge) badge.textContent = filtered.length + ' Pending'; }

            if (filtered.length === 0) { listEl.innerHTML = `<p class="text-center text-[var(--muted)] py-10 text-sm opacity-50">কোনো ${status === 'pending' ? 'অপেক্ষমান' : status === 'approved' ? 'অনুমোদিত' : 'বাতিলকৃত'} অনুরোধ নেই</p>`; return; }

            if (type === 'gmail') {
                listEl.innerHTML = filtered.map(g => `
                    <div class="bg-[rgba(255,255,255,0.03)] rounded-xl p-4 border border-[rgba(255,255,255,0.05)]">
                        <p class="font-bold text-[var(--fg)] mb-1">${g.email}</p>
                        <p class="text-xs text-[var(--warning)] mb-2">Pass: ${g.password}</p>
                        <p class="text-xs text-[var(--muted)] mb-3">User: ${g.userId} | ${g.createdAtFormatted}</p>
                        ${status === 'pending' ? 
                            `<div class="flex gap-2"><button onclick="adminDecision('gmail', '${g.id}', '${g.userId}', 'approved')" class="btn-success-sm">Approve</button><button onclick="adminDecision('gmail', '${g.id}', '${g.userId}', 'rejected')" class="btn-danger">Reject</button></div>` : 
                            `<span class="text-xs status-${status} px-2 py-1 rounded">${getStatusText(status)}</span>`
                        }
                    </div>
                `).join('');
            } else {
                listEl.innerHTML = filtered.map(w => `
                    <div class="bg-[rgba(255,255,255,0.03)] rounded-xl p-4 border border-[rgba(255,255,255,0.05)]">
                        <p class="font-bold text-[var(--fg)] mb-1">${w.amount} TK <span class="text-[var(--accent)]">(${w.method})</span></p>
                        <p class="text-xs text-[var(--warning)] mb-1">${w.wallet}</p>
                        <p class="text-xs text-[var(--muted)] mb-3">User: ${w.userId} | ${w.createdAtFormatted}</p>
                        ${status === 'pending' ? 
                            `<div class="flex gap-2"><button onclick="adminDecision('withdraw', '${w.id}', '${w.userId}', 'approved')" class="btn-success-sm">Approve</button><button onclick="adminDecision('withdraw', '${w.id}', '${w.userId}', 'rejected')" class="btn-danger">Reject</button></div>` : 
                            `<span class="text-xs status-${status} px-2 py-1 rounded">${getStatusText(status)}</span>`
                        }
                    </div>
                `).join('');
            }
        }

        function adminDecision(type, requestId, userId, status) {
            if (type === 'gmail') { const req = gmailSubmissions.find(g => g.id === requestId); if (req) req.status = status; saveGmailSubmissions(); } else { const req = withdrawRequests.find(w => w.id === requestId); if (req) req.status = status; saveWithdrawRequests(); }
            let decisions = JSON.parse(localStorage.getItem('taskBD_adminDecisions') || '[]'); decisions = decisions.filter(d => d.requestId !== requestId); decisions.push({ type, requestId, userId, status, timestamp: Date.now() }); localStorage.setItem('taskBD_adminDecisions', JSON.stringify(decisions));
            renderAdminList(type, adminCurrentTab.status); updateAdminCounts(); showToast(`Request ${status}!`);
        }
        
        function updateAdminCounts() {
            const gPending = gmailSubmissions.filter(g => g.status === 'pending').length; const wPending = withdrawRequests.filter(w => w.status === 'pending').length;
            const gBadge = document.getElementById('gmailPendingCount'); if(gBadge) gBadge.textContent = gPending + ' Pending';
            const wBadge = document.getElementById('withdrawPendingCount'); if(wBadge) wBadge.textContent = wPending + ' Pending';
        }

        // ==================== USER STATUS CHECK ====================
        function checkForUpdates() {
            showLoading('স্ট্যাটাস চেক করা হচ্ছে...');
            setTimeout(() => {
                const adminDecisions = JSON.parse(localStorage.getItem('taskBD_adminDecisions') || '[]');
                const savedGmail = localStorage.getItem('taskBD_gmail'); if (savedGmail) gmailSubmissions = JSON.parse(savedGmail);
                const savedWithdraw = localStorage.getItem('taskBD_withdraw'); if (savedWithdraw) withdrawRequests = JSON.parse(savedWithdraw);
                
                const myDecisions = adminDecisions.filter(d => d.userId === userData.id);
                let updated = false; let updates = [];
                
                myDecisions.forEach(decision => {
                    if (decision.type === 'gmail') { const req = gmailSubmissions.find(g => g.id === decision.requestId); if (req) { req.status = decision.status; if (decision.status === 'approved') { userData.balance += PER_GMAIL; userData.todayEarning += PER_GMAIL; addActivity('gmail', `জিমেইল অনুমোদিত: +${PER_GMAIL} টাকা`, PER_GMAIL); updates.push(`জিমেইল (${req.email}) অনুমোদিত`); } else if (decision.status === 'rejected') { addActivity('gmail', `জিমেইল প্রত্যাখ্যাত: ${req.email}`, 0); updates.push(`জিমেইল (${req.email}) প্রত্যাখ্যাত`); } updated = true; } }
                    else if (decision.type === 'withdraw') { const req = withdrawRequests.find(w => w.id === decision.requestId); if (req) { req.status = decision.status; if (decision.status === 'approved') { userData.totalWithdraw += req.amount; addActivity('withdraw', `উইথড্র অনুমোদিত: ${req.amount} টাকা`, 0); updates.push(`উইথড্র (${req.amount}৳) অনুমোদিত`); } else if (decision.status === 'rejected') { userData.balance += req.amount; addActivity('withdraw', `উইথড্র বাতিল: ${req.amount} টাকা ফেরত`, 0); updates.push(`উইথড্র (${req.amount}৳) বাতিল - টাকা ফেরত`); } updated = true; } }
                });
                
                if (updated) { const remaining = adminDecisions.filter(d => d.userId !== userData.id); localStorage.setItem('taskBD_adminDecisions', JSON.stringify(remaining)); saveUserData(); saveGmailSubmissions(); saveWithdrawRequests(); saveActivities(); updateUI(); renderWithdrawHistory(); renderGmailHistory(); renderActivity(); updatePendingApprovalsCard(); showToast('আপডেট: ' + updates.join(', '), 'success'); } else { showToast('কোনো নতুন আপডেট নেই'); }
                hideLoading();
            }, 1500);
        }

        // ==================== TASK SYSTEM ====================
        function completeTask(taskId) { const task = tasks.find(t => t.id === taskId); if (!task || task.completed) return; task.completed = true; userData.balance += task.reward; userData.todayEarning += task.reward; userData.tasksCompleted++; addActivity('earn', task.title, task.reward); saveTasksState(); saveUserData(); saveActivities(); renderTasks(); updateUI(); showToast('+' + task.reward.toFixed(2) + ' টাকা অর্জিত!'); checkAllTasksCompleted(); }
        function checkAllTasksCompleted() { const allCompleted = tasks.every(t => t.completed); if (allCompleted && !userData.allTasksCompleted) { userData.allTasksCompleted = true; saveUserData(); if (userData.referredBy) { storePendingReferralBonus(userData.referredBy, userData.id); } showToast('অভিনন্দন! সকল টাস্ক সম্পন্ন!'); } }
        function renderTasks() { const container = document.getElementById('tasksList'); const progressEl = document.getElementById('taskProgress'); const progressBar = document.getElementById('taskProgressBar'); if (!container) return; const completed = tasks.filter(t => t.completed).length; if (progressEl) progressEl.textContent = `${completed}/${TOTAL_TASKS} সম্পন্ন`; if (progressBar) progressBar.style.width = (completed / TOTAL_TASKS * 100) + '%'; container.innerHTML = tasks.map(task => `<div class="task-card bg-[rgba(255,255,255,0.03)] rounded-xl p-4 flex items-center justify-between ${task.completed ? 'opacity-60' : ''}"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-xl ${task.completed ? 'bg-[rgba(0,212,170,0.2)]' : 'bg-[rgba(255,255,255,0.05)]'} flex items-center justify-center">${task.completed ? '<svg class="w-5 h-5 text-[var(--accent)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>' : '<svg class="w-5 h-5 text-[var(--muted)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'}</div><div><p class="font-medium ${task.completed ? 'line-through text-[var(--muted)]' : ''}">${task.title}</p><p class="text-sm text-[var(--accent)]">+${task.reward} টাকা</p></div></div>${task.completed ? '<span class="text-sm text-[var(--accent)]">সম্পন্ন</span>' : `<button onclick="completeTask(${task.id})" class="btn-primary py-2 px-4 text-sm ripple">করুন</button>`}</div>`).join(''); }

        // ==================== REFERRAL SYSTEM ====================
        
        // Robust Copy Function
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed"; textArea.style.top = "0"; textArea.style.left = "0";
            textArea.style.width = "2em"; textArea.style.height = "2em";
            textArea.style.padding = "0"; textArea.style.border = "none";
            textArea.style.outline = "none"; textArea.style.boxShadow = "none";
            textArea.style.background = "transparent";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try { document.execCommand('copy'); showToast('লিংক কপি হয়েছে!'); } catch (err) { showToast('কপি করতে সমস্যা হয়েছে', 'error'); }
            document.body.removeChild(textArea);
        }

        function copyReferralLink() {
            const link = `https://t.me/${BOT_USERNAME}?startapp=${userData.referralCode}`;
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(link).then(() => { showToast('লিংক কপি হয়েছে!'); }).catch(() => { fallbackCopyTextToClipboard(link); });
            } else { fallbackCopyTextToClipboard(link); }
        }
        
        function shareOnTelegram() { 
            const link = `https://t.me/${BOT_USERNAME}?startapp=${userData.referralCode}`; 
            const text = 'টাস্ক করে আয় করুন! বটে জয়েন করুন:'; 
            window.location.href = `https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(text)}`; 
        }
        
        function shareOnWhatsApp() { const link = `https://t.me/${BOT_USERNAME}?startapp=${userData.referralCode}`; const text = `টাস্ক করে আয় করুন!\n\nবট লিংক: ${link}`; window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank'); }
        function storePendingReferralBonus(referrerCode, newUserId) { const pendingKey = 'taskBD_pendingBonus_' + referrerCode; const pending = JSON.parse(localStorage.getItem(pendingKey) || '[]'); pending.push({ newUserId: newUserId, completedAt: new Date().toISOString() }); localStorage.setItem(pendingKey, JSON.stringify(pending)); }
        function renderPendingRefers() { const card = document.getElementById('pendingRefersCard'); const list = document.getElementById('pendingRefersList'); if (!card || !list) return; const pendingKey = 'taskBD_pendingBonus_' + userData.referralCode; const pending = JSON.parse(localStorage.getItem(pendingKey) || '[]'); if (pending.length === 0) { card.classList.add('hidden'); return; } card.classList.remove('hidden'); list.innerHTML = pending.map(p => `<div class="bg-[rgba(255,255,255,0.03)] rounded-lg p-3 flex justify-between items-center"><div><p class="text-sm font-medium">${p.newUserId}</p><p class="text-xs text-[var(--muted)]">টাস্ক সম্পন্ন - বোনাস পেতে রিফ্রেশ করুন</p></div><span class="text-[var(--warning)] text-sm">+${PER_REFER} টাকা</span></div>`).join(''); giveReferralBonus(pending, pendingKey); }
        function giveReferralBonus(pending, key) { let totalBonus = 0; pending.forEach(p => { totalBonus += PER_REFER; userData.totalRefers++; }); if (totalBonus > 0) { userData.balance += totalBonus; userData.todayEarning += totalBonus; addActivity('refer', `${pending.length} জন রেফার বোনাস`, totalBonus); saveUserData(); saveActivities(); updateUI(); localStorage.removeItem(key); showToast(`${totalBonus} টাকা রেফার বোনাস পেয়েছেন!`); setTimeout(() => renderPendingRefers(), 1000); } }

        // ==================== ACTIVITY ====================
        function addActivity(type, text, amount) { activities.unshift({ type: type, text: text, amount: amount, time: formatDate(new Date()) }); if (activities.length > 20) activities = activities.slice(0, 20); }
        function renderActivity() { const container = document.getElementById('activityList'); if (!container) return; if (activities.length === 0) { container.innerHTML = '<p class="text-center text-[var(--muted)] py-4">কোনো কার্যকলাপ নেই</p>'; return; } container.innerHTML = activities.slice(0, 10).map(a => `<div class="flex items-center gap-3 p-3 rounded-xl hover:bg-[rgba(255,255,255,0.02)] transition-colors"><div class="w-8 h-8 rounded-lg ${getActivityColor(a.type)} flex items-center justify-center">${getActivityIcon(a.type)}</div><div class="flex-1"><p class="text-sm">${a.text}</p><p class="text-xs text-[var(--muted)]">${a.time}</p></div>${a.amount > 0 ? `<span class="text-sm font-medium text-[var(--accent)]">+${a.amount.toFixed(2)}</span>` : ''}</div>`).join(''); }
        function getActivityColor(type) { const colors = { earn: 'bg-[rgba(0,212,170,0.1)]', withdraw: 'bg-[rgba(255,165,2,0.1)]', gmail: 'bg-[rgba(255,71,87,0.1)]', refer: 'bg-[rgba(255,165,2,0.1)]' }; return colors[type] || 'bg-[rgba(255,255,255,0.05)]'; }
        function getActivityIcon(type) { const icons = { earn: '<svg class="w-4 h-4 text-[var(--accent)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>', withdraw: '<svg class="w-4 h-4 text-[var(--warning)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>', gmail: '<svg class="w-4 h-4 text-[var(--danger)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>', refer: '<svg class="w-4 h-4 text-[var(--warning)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>' }; return icons[type] || ''; }
        function updatePendingApprovalsCard() { const card = document.getElementById('pendingApprovalsCard'); const list = document.getElementById('pendingApprovalsList'); if (!card || !list) return; const pendingWithdraws = withdrawRequests.filter(w => w.status === 'pending'); const pendingGmails = gmailSubmissions.filter(g => g.status === 'pending'); const totalPending = pendingWithdraws.length + pendingGmails.length; if (totalPending === 0) { card.classList.add('hidden'); return; } card.classList.remove('hidden'); let html = ''; pendingWithdraws.forEach(w => { html += `<div class="bg-[rgba(255,255,255,0.03)] rounded-lg p-2 flex justify-between items-center"><div><p class="text-sm">উইথড্র: ${w.amount} টাকা</p><p class="text-xs text-[var(--muted)]">${w.method}</p></div><span class="status-pending px-2 py-1 rounded text-xs">অপেক্ষমান</span></div>`; }); pendingGmails.forEach(g => { html += `<div class="bg-[rgba(255,255,255,0.03)] rounded-lg p-2 flex justify-between items-center"><div><p class="text-sm">জিমেইল: ${g.email}</p></div><span class="status-pending px-2 py-1 rounded text-xs">অপেক্ষমান</span></div>`; }); list.innerHTML = html; }

        // ==================== INITIALIZE ====================
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>